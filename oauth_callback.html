<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Emmy Authentication Complete</title>
    <script type="text/javascript">
      window.onload = function () {
        try {
          // If this window was opened as a popup, signal the opener.
          if (window.opener && !window.opener.closed) {
            console.log("Signaling parent window about completed authentication");
            window.opener.postMessage('auth_complete', '*');
            
            // Also set localStorage as a backup communication method
            try {
              window.opener.localStorage.setItem('emmy_auth_completed', 'true');
            } catch (e) {
              console.error("Error setting localStorage:", e);
            }
          }
        } catch (e) {
          console.error("Error signaling parent window:", e);
        }
        
        // Show a message to the user
        document.body.innerHTML =
          '<div style="padding: 20px; text-align: center; font-family: sans-serif;">' +
          '<h3>Authentication successful!</h3>' +
          '<p>You can now close this window and return to Emmy.</p>' +
          '</div>';
        
        // Close the window after 2 seconds
        setTimeout(function () {
          window.close();
          // In case window.close() is blocked, force a redirect.
          window.location.href = "about:blank";
        }, 2000);
      };
    </script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f5f7f9;
      }
      div {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 30px;
        text-align: center;
        max-width: 400px;
      }
      h3 {
        color: #1E88E5;
        margin-top: 0;
      }
    </style>
  </head>
  <body>
    <div>Processing authentication...</div>
  </body>
</html>